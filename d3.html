<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Lesson1: D3</title>
		<style>
			body, html {
				margin: 0;
			}
			
			fieldset {
				margin-left: 7px;
				border-color: orange;
			}
			
				legend {
					color: orange;
				}
					input {
						margin-top: 5px;
					}
			
			svg {
				margin-top: 5px;
				border-top: 1px dashed lightblue;
			}

				rect {
					fill: none;
					stroke-width: 1;
					stroke: black;
				}
		</style>
		<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	</head>
	<body>
		<fieldset>
			<legend>Настройка</legend>
			В сетке: <input type="number" id="edCntLines" value="10" min="0" max="99"/><sup>2</sup> ячеек<br/>
			Ширина сетки: <input type="number" id="edW" value="400" min="0" max="600" step="10"/> пикселей<br/>
			Высота сетки: <input type="number" id="edH" value="400" min="0" max="600" step="10"/> пикселей
		</fieldset>
		<svg width="100%" height="700"/>
	</body>
		<script>
			d3.select("#edW").on("keyup", buildGrid);
			d3.select("#edH").on("keyup", buildGrid);
			d3.select("#edCntLines").on("keyup", buildGrid);
			
			d3.select("#edW").on("input", buildGrid);			
			d3.select("#edH").on("input", buildGrid);			
			d3.select("#edCntLines").on("input", buildGrid);			
			
			function buildGrid(){
				var	paddingX = paddingY = 10; 						// отступ сетки / для позиционирования
				
				var	wGrid = 	parseInt(d3.select('#edW')[0][0].value, 10),		// ширина сетки
					hGrid = 	parseInt(d3.select('#edH')[0][0].value, 10),		// высота сетки
					cntLines = 	parseInt(d3.select('#edCntLines')[0][0].value, 10),	// количество строк
					wCell = 	wGrid/cntLines, 					// ширина ячейки
					hCell = 	hGrid/cntLines;						// высота ячейки
				
				if (isNaN(wGrid) || isNaN(hGrid) || isNaN(cntLines))	return false;
				
				var svg = d3.select('svg');
				var rect = svg.selectAll('rect').data(d3.range(cntLines*cntLines));
				rect.enter().append('rect').transition().duration(500).attr({
					'x': function (i){ return paddingX + i%cntLines*wCell },
					'y': function (i){ return paddingY + ~~(i/cntLines)*hCell },
					'width': wCell,
					'height': hCell
				});
				rect.transition().duration(500).attr({
					'x': function (i){ return paddingX + i%cntLines*wCell },
					'y': function (i){ return paddingY + ~~(i/cntLines)*hCell },
					'width': wCell,
					'height': hCell
				});
				rect.exit().remove();
			}
			
			buildGrid();
		</script>
</html>
